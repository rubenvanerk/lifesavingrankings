{% extends "lifesaving_rankings/base.html" %}
{% load datetime_filter django_bootstrap_breadcrumbs %}
{% block head_title %}{{ event.name }}{% endblock %}
{% block meta_description %}Find out who has the fastest time for {{ event.name }} on Lifesaving Rankings{% endblock %}

{% block breadcrumbs %}

    {% breadcrumb "Home" "/" %}
    {% breadcrumb "Events" "event-overview" %}
    {% with event_name=event.name|add:" "|add:gender %}
        {% breadcrumb event_name "best-by-event" event.slug gender %}
    {% endwith %}

    {% render_breadcrumbs "lifesaving_rankings/breadcrumb_template.html" %}

{% endblock %}

{% block content %}
    <h1>{{ event.name }} {{ gender }} top results</h1>

    <form action="" method="get" name="filter" autocomplete="off" class="ui filter form">
        <div class="ui styled accordion">
            <div class="title">
                <i class="dropdown icon"></i>
                Filters
            </div>
            <div class="{% if filter.enabled %}active{% endif %} content">
                <div class="ui stackable grid">
                    <div class="three wide column">
                        <p><label>Nationality</label></p>
                        <div class="ui fluid search clearable selection dropdown nationalities">
                            <input type="hidden" name="nationality"
                                   {% if filter.nationality %}value="{{ filter.nationality.pk }}" {% endif %}>
                            <i class="dropdown icon"></i>
                            <div class="{% if not filter.nationality %}default{% endif %} text">
                                {% if filter.nationality %}<i class="{{ filter.nationality.flag_code }} flag"></i>
                                    {{ filter.nationality.name }}
                                {% else %}Select Country
                                {% endif %}
                            </div>
                            <div class="menu">
                                {% for nationality in filter.nationalities %}

                                    <div class="item" data-value="{{ nationality.pk }}">
                                        <i class="{{ nationality.flag_code }} flag"></i> {{ nationality.name }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="six wide column">
                        <p><label>Year of birth</label></p>

                        <div class="two fields">
                            <div class="field">
                                <select class="ui search clearable selection dropdown year-of-birth" name="yob_start"
                                        data-value="{{ filter.yob_start }}">
                                    {% if not filter.yob_start %}
                                        <option value="">
                                            YoB start
                                        </option>
                                    {% endif %}

                                    {% for year in filter.year_of_birth_range reversed %}
                                        <option value="{{ year }}"
                                                {% if year == filter.yob_start %}selected{% endif %}>{{ year }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="field">
                                <select class="ui search clearable selection dropdown year-of-birth" name="yob_end"
                                        data-value="{{ filter.yob_end }}">
                                    {% if not filter.yob_end %}
                                        <option value="">
                                            YoB end
                                        </option>
                                    {% endif %}
                                    {% for year in filter.year_of_birth_range reversed %}
                                        <option value="{{ year }}"
                                                {% if year == filter.yob_end %}selected{% endif %}>{{ year }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

{#                        <p><label>Age</label></p>#}
{##}
{#                        <div class="two fields">#}
{#                            <div class="field">#}
{#                                <input type="number" name="age_min" class="ui input">#}
{#                            </div>#}
{#                            <div class="field">#}
{#                                <input type="number" name="age_max" class="ui input">#}
{#                            </div>#}
{#                        </div>#}
                    </div>

                    <div class="seven wide column">
                        <p><label>Competition date</label></p>

                        <div class="two fields">
                            <div class="field">
                                <div class="ui calendar" id="rangestart">
                                    <div class="ui input left icon">
                                        <i class="calendar icon"></i>
                                        <input type="text" placeholder="Start" name="rangestart"
                                               {% if filter.date_range_start %}value="{{ filter.date_range_start }}" {% endif %}>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <div class="ui calendar" id="rangeend">
                                    <div class="ui input left icon">
                                        <i class="calendar icon"></i>
                                        <input type="text" placeholder="End" name="rangeend"
                                               {% if filter.date_range_end %}value="{{ filter.date_range_end }}" {% endif %}>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="three wide right floated column">
                        <button class="ui labeled icon right floated green button" type="submit"><i
                                class="filter icon"></i>Filter
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div id="bestByEventWrapper">
        <table class="ui celled table" id="bestByEvent">
            <thead>
            <tr>
                <th>#</th>
                <th>Athlete</th>
                <th>YoB</th>
                <th>Time</th>
                <th>Points</th>
                <th>Date</th>
                <th>Competition</th>
            </tr>
            </thead>
            <tbody>
            {% for result in object_list %}
                <tr>
                    <td>
                        {{ forloop.counter }}
                    </td>
                    <td>
                        <a href="{% url 'athlete-overview' result.athlete__slug %}">
                            {% if result.athlete__nationalities__flag_code %}
                                <i class="{{ result.athlete__nationalities__flag_code }} flag"
                                   title="{{ result.athlete__nationalities__name }}"></i>
                            {% endif %}
                            {{ result.athlete__name }}
                        </a>
                    </td>
                    <td>{{ result.athlete__year_of_birth }}</td>
                    <td>{{ result.time|format_time }}</td>
                    <td>{% if result.points > 0 %}{{ result.points }}{% else %} - {% endif %}</td>
                    <td>{{ result.competition__date }}</td>
                    <td>
                        <a href="{% url 'competition-overview' result.competition__slug %}">{{ result.competition__name }}</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

{% endblock %}
